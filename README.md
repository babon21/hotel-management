# Сервис для управления номерами и бронированиями отеля

<!-- ToC start -->
# Обзор

1. [Запуск приложения](#Запуск-приложения)
1. [Запуск линтера](#Запуск-линтера)
1. [Реализация](#Реализация)
1. [Усложнения](#Реализация)
1. [Используемые библиотеки](#Используемые-библиотеки)
1. [API](#API)
<!-- ToC end -->

# Запуск приложения
```
docker-compose up
``` 

# Запуск линтера
Предварительно необходимо установить линтер в локальный репозиторий командой:
```
make lint-prepare
```
Запуск линтера:
```
make lint
```

# Юнит-тесты
Запуск юнит-тестов:
```
make test
```

# Реализация
- Язык программирования Go
- База данных PostgreSQL
- HTTP JSON API
# Усложнения
- Следование принципам подхода "Чистая архитектура"
- Покрытие кода Юнит тестами
- Использование индексов БД (создание в файле init.sql)
- Докеризация приложения и запуск с помощью `docker-compose`
- Многоэтапная сборка Docker-образа сервиса
- Использование переменных окружения для конфигурации приложения (One of The Twelve-Factor App)
- Использование линтера `golangci-lint`
- Логирование HTTP запросов с помощью middleware
# Используемые библиотеки
- Веб-фреймворк `echo`
- Конфигурирование приложения - библиотека `viper`
- `sqlx` для работы с БД
- Генерация mock-объектов для unit-тестирования - `mockery`
- Логирование с помощью `zerolog`

# API
## API для работы с каталогом номеров отеля:
### POST /rooms
**Добавить номер отеля.**
Принимает на вход текстовое описание и цену за ночь. Возвращает ID номера отеля.
```
{
    "price": "string",
    "desc": "string"
}
```

#### Пример запроса и ответа
Запрос:
```
curl --request POST 'localhost:9090/rooms' \
--header 'Content-Type: application/json' \
--data-raw '{
    "price": "105",
    "desc": "some desc"
}'
```
Ответ:
```
{
  "id": "1"
}
```

### GET /rooms
**Получить список номеров отеля.**
Сортировка по цене или по дате добавления (по возрастанию и убыванию).

Обязательные параметры: 
- sort_by (available values: price, date_added)
- order_by (available values: asc, desc)

#### Пример запроса и ответа
Запрос:
```
curl --request GET 'localhost:9090/rooms?sort_by=date_added&order_by=desc'
```
Ответ:
```
[
  {
    "id": "1",
    "price": "105",
    "desc": "some desc",
    "date_added": "2021-01-17T19:09:56.986621Z"
  }
]
```
### DELETE /rooms/:id
**Удалить номер отеля и все его брони.**
Принимает на вход ID номера отеля.
#### Пример запроса и ответа
Запрос:
```
curl --request DELETE 'localhost:9090/rooms/1'
```
Ответ:
```
204 HTTP status code
```
## API для работы со списком броней номеров:
### POST /bookings
**Добавить бронь.**
Принимает на вход существующий ID номера отеля, дату начала, дату окончания брони. Возвращает ID брони.
#### Пример запроса и ответа
Запрос:
```
curl --request POST 'localhost:9090/bookings' \
--header 'Content-Type: application/json' \
--data-raw '{
    "room_id": "2",
    "start_date": "2030-11-01",
    "expiration_date": "2020-02-21"
}'
```
Ответ:
```
{
  "id": "1"
}
```
### GET /bookings
**Получить список броней номера отеля.** 
Принимает на вход ID номера отеля. Возвращает список бронирований, каждое бронирование содержит ID, дату начала, дату окончания. Бронирования отсортированы по дате начала.
#### Пример запроса и ответа
Запрос:
```
curl --request GET 'localhost:9090/bookings?room_id=2'
```
Ответ:
```
[
  {
    "id": "1",
    "start_date": "2030-11-01",
    "expiration_date": "2020-02-21"
  }
]
```
### DELETE /bookings/:id
**Удалить бронь.**
Принимает на вход ID брони.
#### Пример запроса и ответа
Запрос:
```
curl --request DELETE 'localhost:9090/bookings/1'
```
Ответ:
```
204 HTTP status code
```
